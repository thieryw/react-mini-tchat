{"version":3,"sources":["components/User/Contacts.tsx","components/User/Conversation.tsx","components/User/User.tsx","components/App/App.tsx","logic.ts","index.tsx"],"names":["Contacts","props","user","store","isComponentVisible","useReducer","x","forceUpdate","asyncNewConversation","useAsyncCallback","newConversation","asyncEmptyInterlocutor","emptyInterlocutors","asyncSelectInterlocutor","selectInterlocutor","asyncUnselectInterlocutor","unselectInterlocutor","useEvt","ctx","Evt","merge","evtInterlocutorSelected","evtInterlocutorUnselected","attach","data","same","backToConversation","useCallback","execute","className","style","height","loading","type","value","color","disabled","onClick","interlocutors","map","interlocutor","name","contacts","length","contact","index","key","Contact","useState","isSelected","setIsSelected","handleClick","evtConversationStarted","evtInterlocutorsEmptied","_user","Conversation","textInput","setTextInput","numberOfMessagesToDisplay","setNumberOfMessagesToDisplay","currentScrollHeight","setCurrentScrollHeight","messagesRef","useRef","asyncSendMessage","sendMessage","asyncUnselectConversation","unselectConversation","handleSubmit","evtMessageSent","emitter","currentConversation","participants","scrollToBottom","current","scrollHeight","evtConversationSelected","scrollTo","handleScroll","a","scrollTop","Promise","resolve","undefined","messages","participant","onScroll","ref","message","onChange","target","Message","messageRef","adjustWidth","setTimeout","width","useEffect","description","User","isUserVisible","isContactVisible","setIsContactVisible","isConversationVisible","setIsConversationVisible","evtConversationUnselected","selectConversation","conversation","conversationsStyle","display","conversations","App","userIndex","setUserIndex","window","changeUser","users","getStore","simulateNetworkDelay","ms","out","i","push","forEach","_index","params","post","splice","indexOf","Error","console","log","conversationId","Switcher","asyncGetStore","useAsync","result","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.d99a2b93.chunk.js","sourcesContent":["import React, {useCallback, useState, useReducer} from \"react\";\nimport {Store} from \"../../logic\";\nimport {useAsyncCallback, UseAsyncReturn} from \"react-async-hook\";\nimport {useEvt} from \"evt/hooks\";\nimport {same} from \"evt/tools/inDepth\";\nimport {Evt} from \"evt\";\nimport \"./Contacts.scss\";\n\n\n\n\nexport const Contacts: React.FunctionComponent<{\n    user: Store[\"users\"][number];\n    store: Pick<Store,\n        \"evtInterlocutorSelected\" |\n        \"newConversation\" |\n        \"selectInterlocutor\" |\n        \"unselectInterlocutor\" |\n        \"evtInterlocutorUnselected\" |\n        \"emptyInterlocutors\" |\n        \"evtInterlocutorsEmptied\" |\n        \"evtConversationStarted\"\n\n    >;\n\n    isComponentVisible: boolean;\n\n}> = (props)=>{\n\n\n    const {user, store, isComponentVisible} = props;\n    const [, forceUpdate] = useReducer(x=>x+1, 0);\n    \n\n\n    const asyncNewConversation = useAsyncCallback(store.newConversation);\n    const asyncEmptyInterlocutor = useAsyncCallback(store.emptyInterlocutors);\n    const asyncSelectInterlocutor = useAsyncCallback(store.selectInterlocutor);\n    const asyncUnselectInterlocutor = useAsyncCallback(store.unselectInterlocutor);\n    useEvt(ctx =>{\n\n        Evt.merge(ctx, [store.evtInterlocutorSelected, store.evtInterlocutorUnselected]).attach(\n            data => same(user, data.user),\n            ()=> forceUpdate()\n        );\n\n        \n        \n\n    }, [store, user]);\n\n\n\n\n    const backToConversation = useCallback(()=>{\n        \n        asyncEmptyInterlocutor.execute(user);\n\n    },[asyncEmptyInterlocutor, user])\n\n    \n\n\n\n    return(\n        <div \n            className=\"contacts\"\n            style={\n                {\n                    height: isComponentVisible && \n                    !asyncEmptyInterlocutor.loading &&\n                    !asyncNewConversation.loading ?\n                    \"100%\" : \"0%\",\n                }\n            }\n        >\n            <header>\n                <input \n                    type=\"button\" \n                    value=\"<\"\n                    style={\n                        {color: asyncEmptyInterlocutor.loading\n                            || \n                        asyncNewConversation.loading ? \"grey\" : \"greenyellow\"}\n                    }\n                    disabled={asyncEmptyInterlocutor.loading}\n                    onClick={backToConversation}\n                />\n                <div>\n                    <h2>Contacts</h2>\n                    {\n                        asyncSelectInterlocutor.loading ||\n                        asyncUnselectInterlocutor.loading ?\n                        <em className=\"loading\">Loading...</em> : \n                        <em>{user.interlocutors.map(interlocutor => `${interlocutor.name}, `)}</em>\n                    }\n                    \n\n                </div>\n\n\n            </header>\n            <em>{user.contacts.length} contacts</em>\n\n            <section>\n                {\n                    user.contacts.map(\n                        (contact, index)=> \n                                <Contact \n                                    store={store} \n                                    contact={contact} \n                                    user={user}\n                                    asyncSelectInterlocutor={asyncSelectInterlocutor}\n                                    asyncUnselectInterlocutor={asyncUnselectInterlocutor}\n                                    key={index}\n                                />\n\n                    )\n                    \n                }\n            </section>\n\n\n\n            <input \n                disabled={user.interlocutors.length === 0} \n                className={user.interlocutors.length === 0 ? \"disabled\" : \"\"}\n                type=\"button\" \n                value=\">\"\n                onClick={\n                    useCallback(()=>\n                        asyncNewConversation.execute(user)\n                    , [user, asyncNewConversation])\n\n                }\n            />\n\n\n\n\n\n        </div>\n    )\n}\n\nconst Contact: React.FunctionComponent<{\n    contact: Store[\"users\"][number][\"contacts\"][number];\n    user: Store[\"users\"][number];\n    store: Pick<Store,\n        \"selectInterlocutor\" |\n        \"evtInterlocutorSelected\"|\n        \"unselectInterlocutor\" |\n        \"evtInterlocutorUnselected\" |\n        \"evtInterlocutorsEmptied\" |\n        \"evtConversationStarted\"\n\n    >\n\n    asyncSelectInterlocutor: UseAsyncReturn<void, [{\n        user: Store[\"users\"][number];\n        contact: Store[\"users\"][number];\n    }]>\n\n    asyncUnselectInterlocutor: UseAsyncReturn<void, [{\n        user: Store[\"users\"][number];\n        contact: Store[\"users\"][number];\n    }]>\n\n}> = (props)=>{\n\n    const {\n        contact, \n        user, \n        store, \n        asyncSelectInterlocutor, \n        asyncUnselectInterlocutor\n    } = props;\n\n    const [isSelected, setIsSelected] = useState(false);\n\n    const handleClick = useCallback(()=>{\n        if(isSelected){\n            asyncUnselectInterlocutor.execute({user, contact});\n            return;\n        }\n\n        asyncSelectInterlocutor.execute({user, contact});\n\n    }, [isSelected, contact, user, asyncUnselectInterlocutor, asyncSelectInterlocutor]);\n\n    useEvt(ctx=>{\n\n        Evt.merge(ctx, [store.evtInterlocutorSelected, store.evtInterlocutorUnselected]).attach(\n            data => same(user, data.user) && same(contact, data.contact),\n            ()=> setIsSelected(!isSelected)\n        );\n\n\n        Evt.merge(ctx, [store.evtConversationStarted, store.evtInterlocutorsEmptied]).attach(\n            _user => same(user, _user) && isSelected,\n            () => setIsSelected(false)\n        );\n\n\n\n\n    },[contact, user, store, isSelected])\n\n    return(\n        <div className={`contact ${isSelected ? \"contact-selected\" : \"\"}`} onClick={handleClick}>\n\n            <p>{contact.name}</p>\n\n\n        </div>\n\n    )\n\n}","import React, {useState, useCallback, useReducer, useRef, useEffect} from \"react\";\nimport {Store} from \"../../logic\";\nimport {useAsyncCallback} from \"react-async-hook\";\nimport {useEvt} from \"evt/hooks\";\nimport {same} from \"evt/tools/inDepth\";\nimport \"./Conversation.scss\";\n\n\nexport const Conversation: React.FunctionComponent<{\n    store: Pick<Store,\n        \"sendMessage\" |\n        \"evtMessageSent\" |\n        \"evtConversationSelected\" |\n        \"unselectConversation\" |\n        \"evtConversationUnselected\"\n    >;\n    user: Store[\"users\"][number];\n    isComponentVisible: boolean;\n    \n}> = (props)=>{\n    const {user, isComponentVisible, store} = props;\n    const [textInput, setTextInput] = useState(\"\");\n    const [numberOfMessagesToDisplay, setNumberOfMessagesToDisplay] = useState(10);\n    const [currentScrollHeight, setCurrentScrollHeight] = useState(0);\n\n   \n    const [, forceUpdate] = useReducer(x=>x+1, 0);\n    const messagesRef = useRef<HTMLDivElement>(null);\n\n    const asyncSendMessage = useAsyncCallback(store.sendMessage);\n    const asyncUnselectConversation = useAsyncCallback(store.unselectConversation);\n\n    const handleSubmit = useCallback(()=>{\n\n        asyncSendMessage.execute({\n            \"description\": textInput,\n            \"emitter\": user\n        });\n\n\n        \n\n        setTextInput(\"\");\n\n\n\n    },[textInput, asyncSendMessage, user]);\n\n    useEvt(ctx =>{\n        store.evtMessageSent.attach(\n            data => same(\n                data.emitter.currentConversation?.participants,\n                user.currentConversation?.participants\n            ),\n            ctx,\n            ()=> {\n               forceUpdate(); \n               scrollToBottom();\n\n               if(!messagesRef || !messagesRef.current){\n                   return;\n               }\n\n               setCurrentScrollHeight(messagesRef.current.scrollHeight);\n            }\n        );\n\n\n        store.evtConversationSelected.attach(\n            data => same(data.user, user),\n            ctx,\n            ()=> {\n                forceUpdate();\n                setNumberOfMessagesToDisplay(10);\n                scrollToBottom();\n                if(!messagesRef || !messagesRef.current){\n                    return;\n                }\n                setCurrentScrollHeight(messagesRef.current.scrollHeight);\n            }\n        );\n        \n\n    },[store, user]);\n\n\n    const scrollToBottom = useCallback(()=>{\n        if(!messagesRef || !messagesRef.current){\n            return;\n        }\n\n        messagesRef.current.scrollTo(0, messagesRef.current.scrollHeight);\n\n    },[])\n\n    \n    const handleScroll = useCallback( async ()=>{\n\n\n\n        if(!messagesRef || !messagesRef.current){\n            return;\n        }\n\n        if(messagesRef.current.scrollTop !== 0){\n            return;\n        }\n\n        await new Promise<void>(resolve =>{\n            if(user.currentConversation === undefined\n                || user.currentConversation.messages.length === numberOfMessagesToDisplay\n            ){\n                return;\n            }\n\n\n            if(numberOfMessagesToDisplay + 5 > user.currentConversation.messages.length){\n                setNumberOfMessagesToDisplay(user.currentConversation.messages.length);\n                resolve();\n            }\n\n            setNumberOfMessagesToDisplay(numberOfMessagesToDisplay + 5);\n            resolve();\n            \n        })\n        \n\n        messagesRef.current.scrollTo(\n            0, messagesRef.current.scrollHeight - currentScrollHeight\n        );\n\n        setCurrentScrollHeight(messagesRef.current.scrollHeight);\n\n    },[numberOfMessagesToDisplay, user.currentConversation, currentScrollHeight]);\n\n    \n\n    \n\n\n\n    return(\n\n        <div \n            className=\"Conversation\"\n            style={\n                {\n                    height: isComponentVisible \n                    && !asyncUnselectConversation.loading ? \"100%\" : \"0%\"\n                }\n            }\n        >\n            <header>\n                <h3>\n                    {\n                        user.currentConversation?.participants.map(\n                            participant => `${participant.name}, `\n                        )\n                    }\n                </h3>\n                <input \n                    type=\"button\"\n                    value=\"<\"\n                    onClick={\n                        useCallback(()=>{\n\n                            asyncUnselectConversation.execute(user);\n\n                        }, [user, asyncUnselectConversation])\n                    }\n                />\n            </header>\n\n\n            <div onScroll={handleScroll} ref={messagesRef} className=\"messages\">\n\n                {\n                    user.currentConversation?.messages.map(\n                        (message, index) => \n                            user.currentConversation === undefined ? \"\" : \n                            index < user.currentConversation.messages.length - numberOfMessagesToDisplay ? \"\" :\n                            <Message \n                                key={index} \n                                message={message}\n                                user={user}\n                                \n                            />\n                         \n\n                    )\n                }\n            </div>\n\n            <form>\n                <textarea \n                    className=\"text-input\"\n                    onChange={useCallback(({target}) => setTextInput(target.value), [])} \n                    value={textInput}\n                />\n\n                <input \n                    className=\"submit\"\n                    type=\"submit\" \n                    value={asyncSendMessage.loading ? \"...\" : \">\"}\n                    disabled={asyncSendMessage.loading}\n                    onClick={handleSubmit}\n                />\n\n            </form>\n                \n\n\n\n\n        </div>\n\n    )\n}\n\nconst Message: React.FunctionComponent<{\n    message: Store[\"users\"][number][\"conversations\"][number][\"messages\"][number];\n    user: Store[\"users\"][number];\n\n}> = (props)=>{\n\n    const {message, user} = props\n\n    const messageRef = useRef<HTMLDivElement>(null);\n\n\n\n    const adjustWidth = useCallback(async ()=>{\n\n        await new Promise<void>(resolve => setTimeout(resolve, 1));\n\n        if(!messageRef || !messageRef.current){\n                return;\n        }\n\n        messageRef.current.style.width = \"100%\";\n\n    },[messageRef]);\n\n    useEffect(()=>{\n\n        adjustWidth();\n\n\n    },[adjustWidth]);\n\n\n\n\n\n\n\n\n\n\n    return(\n        <div \n            ref={messageRef}\n            className={message.emitter === user ? \"outgoing\" : \"incoming\"}\n            style={\n                {\n                    width: \"50%\"\n\n                }\n            }\n        >\n            <div>\n                <em>{message.emitter.name}</em>\n                <p>{\n                    message.description\n                }</p>\n            </div>\n\n        </div>\n    )\n}","import React, {useState, useCallback} from \"react\";\nimport {Store} from \"../../logic\";\nimport {useEvt} from \"evt/hooks\";\nimport {same} from \"evt/tools/inDepth\";\nimport {Contacts} from \"./Contacts\";\nimport {Conversation} from \"./Conversation\";\nimport {Evt} from \"evt\";\nimport \"./User.scss\";\n\n\n\n\nexport const User: React.FunctionComponent<{\n    user: Store[\"users\"][number];\n    isUserVisible: boolean;\n    store: Omit<Store,\n        \"users\"\n    >;\n}> = (props)=>{\n\n    const {user, store, isUserVisible} = props;\n    const [isContactVisible, setIsContactVisible] = useState(false);\n    const [isConversationVisible, setIsConversationVisible] = useState(false);\n\n    useEvt(ctx=>{\n        \n\n        Evt.merge(ctx, [store.evtConversationStarted, store.evtInterlocutorsEmptied]).attach(\n            _user => same(_user, user),\n            () => setIsContactVisible(false)\n        );\n\n        \n\n        store.evtConversationUnselected.attach(\n            _user => same(user, _user),\n            ctx,\n            () => setIsConversationVisible(false)\n        );\n\n        store.evtConversationSelected.attach(\n            data => same(data.user, user),\n            ctx,\n            () => setIsConversationVisible(true)\n        );\n\n\n\n    },[store, user]);\n\n\n    const selectConversation = useCallback((conversation: Store[\"users\"][number][\"conversations\"][number])=>{\n\n\n\n        store.selectConversation({\n            conversation,\n            user\n        });\n\n\n\n\n    },[store, user])\n\n    const conversationsStyle = {\n        display: isContactVisible || isConversationVisible ? \"none\" : \"flex\"\n\n    }\n\n\n\n    return(\n        <div className={isUserVisible ? \"User\" : \"hidden\"}>\n            <div className=\"conversation-wrapper\" style={conversationsStyle}>\n                <header>\n                    <div>\n                        <h2>{user.name}</h2>\n                    </div>\n\n\n                    <input type=\"button\" value=\"+\" onClick={useCallback(()=> setIsContactVisible(true), [])}/>\n\n                </header>\n\n                <div className=\"conversations\">\n\n                    {\n                        user.conversations.length === 0 ? \"\" : \n                        user.conversations.map((conversation, index) => \n                            <div \n                                className=\"conversation-li\"\n                                key={index}\n                                onClick={()=> selectConversation(conversation)}\n                            >\n                            {\n                                <p>\n                                    {\n                                        conversation.participants.map(participant => `${participant.name}, `)\n                                    }\n                                </p>\n                            }\n                            </div>\n                        )\n                    }\n\n\n                </div>\n            </div>\n\n            <Contacts store={store} user={user} isComponentVisible={isContactVisible}/>\n\n\n            <Conversation \n                isComponentVisible={isConversationVisible}\n                store={store}\n                user={user}\n            />\n\n\n\n\n\n\n\n        </div>\n    )\n}","import React, {useState} from \"react\";\nimport {Store} from \"../../logic\";\nimport {User} from \"../User/User\";\nimport \"./App.scss\";\n\n\n\nexport const App: React.FunctionComponent<{store: Store}> = (props)=>{\n\n    const {store} = props;\n    const [userIndex, setUserIndex] = useState(0);\n\n\n\n    (window as any).changeUser = function(index: number){\n        if(index >= store.users.length || index < 0){\n            return;\n        }\n\n        setUserIndex(index);\n    }\n  \n\n    \n\n\n    return(\n        <div className=\"App\">\n\n            {\n                store.users.map(\n                    (user, index) => <User user={user} isUserVisible={userIndex === index} store={store} key={index}/>\n                )\n            }\n\n\n        </div>\n    )\n}","import {Evt, NonPostableEvt, ToPostableEvt} from \"evt\";\n\n\ntype Message = {\n    description: string;\n    emitter: User;\n    receivers: User[];\n}\n\ntype Conversation = {\n    participants: User[];\n    messages: Message[];\n    id: number;\n}\ntype User = {\n    name: string;\n    contacts: User[];\n    interlocutors: User[];\n    conversations: Conversation[];\n    currentConversation: Conversation | undefined;\n    id: number;\n\n}\n\nexport type Store = {\n    users: User[];\n    selectInterlocutor: (params: {user: User; contact: User}) => Promise<void>;\n    unselectInterlocutor: (params: {user: User; contact: User}) => Promise<void>;\n    emptyInterlocutors: (user: User) => Promise<void>;\n    selectConversation: (params: {user: User; conversation: Conversation})=> Promise<void>;\n    unselectConversation: (user: User)=> Promise<void>;\n    sendMessage: (params: {emitter: User; description: string}) => Promise<void>;\n    newConversation: (user: User)=> Promise<void>;\n\n    evtInterlocutorSelected: NonPostableEvt<Parameters<Store[\"selectInterlocutor\"]>[0]>;\n    evtInterlocutorUnselected: NonPostableEvt<Parameters<Store[\"unselectInterlocutor\"]>[0]>;\n    evtInterlocutorsEmptied: NonPostableEvt<User>;\n    evtMessageSent: NonPostableEvt<Parameters<Store[\"sendMessage\"]>[0]>;\n    evtConversationSelected: NonPostableEvt<Parameters<Store[\"selectConversation\"]>[0]>;\n    evtConversationUnselected: NonPostableEvt<User>;\n    evtConversationStarted: NonPostableEvt<Parameters<Store[\"newConversation\"]>[0]>;\n}\n\n\nexport async function getStore(): Promise<Store>{\n\n    const simulateNetworkDelay = (ms: number)=>{\n        return new Promise<void>(resolve => setTimeout(resolve, ms));\n    }\n\n    const users: User[] = (()=>{\n        const out: User[] = [];\n        for(let i = 0; i < 30; i++){\n            out.push({\n                \"contacts\": [],\n                \"name\": `User ${i+1}`,\n                \"interlocutors\": [],\n                \"conversations\": [],\n                \"currentConversation\": undefined,\n                \"id\": i\n            })\n        }\n\n        out.forEach((user, index)=>{\n            out.forEach((_user, _index)=>{\n                if(index === _index){\n                    return;\n                }\n\n                user.contacts.push(_user);\n            });\n        });\n\n\n        return out;\n\n    })();\n\n    let conversationId: 0;\n\n\n    const store: ToPostableEvt<Store> = {\n       users,\n       \"evtInterlocutorSelected\": new Evt(),\n       \"evtInterlocutorUnselected\": new Evt(),\n       \"evtInterlocutorsEmptied\": new Evt(),\n       \"evtMessageSent\": new Evt(),\n       \"evtConversationStarted\": new Evt(),\n       \"evtConversationSelected\": new Evt(),\n       \"evtConversationUnselected\": new Evt(),\n\n       \"selectInterlocutor\": async params =>{\n           const {contact, user} = params;\n\n           await simulateNetworkDelay(300);\n\n           user.interlocutors.push(contact);\n\n           store.evtInterlocutorSelected.post(params);\n\n       },\n\n       \"unselectInterlocutor\": async params =>{\n           const {contact, user} = params;\n\n           await simulateNetworkDelay(300);\n\n\n           user.interlocutors.splice(\n               user.interlocutors.indexOf(contact),\n               1\n           );\n\n           store.evtInterlocutorUnselected.post(params);\n\n       },\n\n       \"emptyInterlocutors\": async user =>{\n           await simulateNetworkDelay(300);\n\n           user.interlocutors = [];\n\n           store.evtInterlocutorsEmptied.post(user);\n       },\n\n       \"selectConversation\": async params =>{\n           const {conversation, user} = params;\n\n           await simulateNetworkDelay(300);\n\n           user.currentConversation = conversation;\n\n           store.evtConversationSelected.post(params);\n\n       },\n\n       \"unselectConversation\": async user =>{\n\n           await simulateNetworkDelay(300);\n\n           user.currentConversation = undefined;\n\n           store.evtConversationUnselected.post(user);\n\n       },\n\n       \"newConversation\": async user =>{\n           await simulateNetworkDelay(300);\n\n           try{\n               if(user.interlocutors.length === 0){\n                   throw new Error(\"Error! No interlocutors selected\");\n               }\n\n           }catch(err){\n                console.log(err);\n                return;\n           }\n\n           const newConversation: Conversation = {\n               \"id\": conversationId++,\n               \"messages\": [],\n               \"participants\": (()=>{\n                   const out: User[] = [];\n\n                   out.push(user);\n\n                   user.interlocutors.forEach(user =>{\n                       out.push(user);\n                   });\n\n                   return out;\n               })()\n\n           }\n\n           user.conversations.push(newConversation);\n\n           user.interlocutors.forEach(interlocutor => interlocutor.conversations.push(newConversation));\n\n           user.interlocutors = [];\n\n           store.evtConversationStarted.post(user);\n       },\n\n       \"sendMessage\": async params =>{\n           const {emitter, description} = params;\n\n           await simulateNetworkDelay(300);\n\n           emitter.currentConversation?.messages.push({\n               description,\n               emitter,\n               \"receivers\": (()=>{\n\n                   const out: User[] = [];\n\n                   emitter.currentConversation.participants.forEach(participant =>{\n                       if(participant === emitter){\n                           return;\n                       }\n\n                       out.push(participant);\n                   })\n\n                   return out;\n               })()\n           });\n\n\n           store.evtMessageSent.post(params);\n\n\n       }\n\n    }\n\n\n    await simulateNetworkDelay(1500);\n\n\n    return store;\n\n\n\n}\n\n\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\n//import * as serviceWorker from './serviceWorker';\nimport {App} from \"./components/App/App\";\nimport {useAsync} from \"react-async-hook\";\nimport {getStore} from \"./logic\";\n\nconst Switcher: React.FunctionComponent = ()=>{\n  \n  const asyncGetStore = useAsync(getStore, []);\n  \n  \n  return(\n    asyncGetStore.result === undefined ? \n      <h1>Loading...</h1> : \n      <App store={asyncGetStore.result} \n    />\n\n  )\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <Switcher />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n//serviceWorker.unregister();\n"],"sourceRoot":""}