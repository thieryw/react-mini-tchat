(this["webpackJsonpreact-mini-tchat"]=this["webpackJsonpreact-mini-tchat"]||[]).push([[0],{37:function(e,t,n){e.exports=n(78)},42:function(e,t,n){},76:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(35),u=n.n(c),s=(n(42),n(3)),o=function(e){var t=e.message;return a.a.createElement("div",{className:t.direction},a.a.createElement("em",null,"incoming"===t.direction?"From ".concat(t.emitter.name):"to ".concat(t.receiver.name)),a.a.createElement("p",null,t.description))},i=n(15),l=function(){return a.a.createElement("i",{className:"fa fa-spin fa-spinner"})},m=function(e){var t=e.user,n=e.store,c=e.isMessageLoading,u=Object(r.useReducer)((function(e){return e+1}),0),m=Object(s.a)(u,2)[1];return Object(i.useEvt)((function(e){n.evtMessageSent.attach((function(e){var n;return e.user.id===t.id||(null===(n=e.user.interlocutor)||void 0===n?void 0:n.id)===t.id}),e,(function(){return m()}))}),[n]),a.a.createElement("div",{className:"message-wrapper"},a.a.createElement("h2",null,"Messages"),a.a.createElement("div",{className:"messages"},c?a.a.createElement("div",{className:"outgoing"},a.a.createElement("p",null,a.a.createElement(l,null))):"",t.messages.map((function(e,t){return a.a.createElement(o,{key:t,message:e})})).reverse()))},f=function(e){var t=e.asyncSendMessage,n=e.user,c=Object(r.useState)(""),u=Object(s.a)(c,2),o=u[0],i=u[1],l=Object(r.useCallback)((function(e){e.preventDefault(),""!==o&&(t.execute({user:n,description:o}),i(""))}),[o,t,n]);return a.a.createElement("form",{onSubmit:l},a.a.createElement("textarea",{value:o,onChange:Object(r.useCallback)((function(e){var t=e.target;return i(t.value)}),[])}),a.a.createElement("input",{disabled:void 0===n.interlocutor,type:"submit",value:"send message"}))},d=function(e){var t=e.contacts,n=e.user,r=e.asyncChangeInterlocutor;return a.a.createElement("ul",null,t.map((function(e){return a.a.createElement("li",{key:e.id,onClick:function(){return r.execute({user:n,newInterlocutor:e})}},e.name)})))},v=n(36),p=n(11),g=function(e){var t=e.user,n=e.store,c=e.isCurrentUser,u=Object(r.useReducer)((function(e){return e+1}),0),o=Object(s.a)(u,2)[1],g=Object(r.useMemo)((function(){var e=[];return n.users.forEach((function(n){n!==t&&e.push(n)})),e}),[n,t]);Object(i.useEvt)((function(e){n.evtInterlocutorChanged.attach((function(e){return Object(v.same)(t,e.user)}),e,(function(){return o()}))}),[n]);var E=Object(p.b)(n.changeInterlocutor),b=Object(p.b)(n.sendMessage);return a.a.createElement("div",{className:"user ".concat(c?"current":"")},a.a.createElement("div",{className:"contacts"},void 0===t.interlocutor?"":E.loading?a.a.createElement("h2",null,a.a.createElement(l,null)):a.a.createElement("h2",null,t.interlocutor.name),a.a.createElement(d,{contacts:g,user:t,asyncChangeInterlocutor:E})),a.a.createElement("div",{className:"flex-message-and-form"},a.a.createElement(m,{user:t,store:n,isMessageLoading:b.loading}),a.a.createElement(f,{user:t,asyncSendMessage:b})))},E=(n(76),function(e){var t=e.store,n=Object(r.useState)(0),c=Object(s.a)(n,2),u=c[0],o=c[1],i=Object(r.useCallback)((function(){u!==t.users.length-1?o(u+1):o(0)}),[u,t.users.length]);return a.a.createElement("div",{className:"App"},a.a.createElement("header",null,a.a.createElement("h1",null,t.users[u].name),a.a.createElement("input",{type:"button",value:"Toggle User",onClick:i})),t.users.map((function(e,n){return a.a.createElement(g,{store:t,user:e,key:n,isCurrentUser:u===n})})))}),b=n(4),h=n.n(b),j=n(16),O=n(10);function k(){return w.apply(this,arguments)}function w(){return(w=Object(j.a)(h.a.mark((function e(){var t,n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},n=function(){for(var e=[],t=0;t<3;t++)e.push({id:t,messages:[],name:"user ".concat(t+1),interlocutor:void 0});return e}(),r={evtMessageSent:new O.Evt,evtInterlocutorChanged:new O.Evt,sendMessage:function(){var e=Object(j.a)(h.a.mark((function e(n){var a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(300);case 2:if(a=n.user,c=n.description,void 0!==a.interlocutor){e.next=5;break}return e.abrupt("return");case 5:a.messages.push({description:c,direction:"outgoing",receiver:a.interlocutor,emitter:a}),a.interlocutor.messages.push({description:c,direction:"incoming",receiver:a.interlocutor,emitter:a}),r.evtMessageSent.post(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),changeInterlocutor:function(){var e=Object(j.a)(h.a.mark((function e(n){var a,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.user,c=n.newInterlocutor,e.next=3,t(300);case 3:a.interlocutor=c,r.evtInterlocutorChanged.post(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),users:n},e.next=5,t(1500);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=function(){var e=Object(p.a)(k,[]);return void 0===e.result?a.a.createElement("h1",null,"Loading..."):a.a.createElement(E,{store:e.result})};u.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(y,null)),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.3cbcb6de.chunk.js.map