(this["webpackJsonpreact-mini-tchat"]=this["webpackJsonpreact-mini-tchat"]||[]).push([[0],{37:function(e,t,n){e.exports=n(81)},42:function(e,t,n){},76:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(36),o=n.n(a),s=(n(42),n(3)),u=n(9),i=n(4),l=n(7),v=n(2),m=(n(76),function(e){var t=e.user,n=e.store,a=e.isComponentVisible,o=Object(r.useReducer)((function(e){return e+1}),0),m=Object(s.a)(o,2)[1],p=Object(l.b)(n.newConversation),b=Object(l.b)(n.emptyInterlocutors),d=Object(l.b)(n.selectInterlocutor),h=Object(l.b)(n.unselectInterlocutor);Object(u.useEvt)((function(e){v.Evt.merge(e,[n.evtInterlocutorSelected,n.evtInterlocutorUnselected]).attach((function(e){return Object(i.same)(t,e.user)}),(function(){return m()}))}),[n,t]);var E=Object(r.useCallback)((function(){b.execute(t)}),[b,t]);return c.a.createElement("div",{className:"contacts",style:{height:!a||b.loading||p.loading?"0%":"100%"}},c.a.createElement("header",null,c.a.createElement("input",{type:"button",value:"<",style:{color:b.loading||p.loading?"grey":"greenyellow"},disabled:b.loading,onClick:E}),c.a.createElement("div",null,c.a.createElement("h2",null,"Contacts"),d.loading||h.loading?c.a.createElement("em",{className:"loading"},"Loading..."):c.a.createElement("em",null,t.interlocutors.map((function(e){return"".concat(e.name,", ")}))))),c.a.createElement("em",null,t.contacts.length," contacts"),c.a.createElement("section",null,t.contacts.map((function(e,r){return c.a.createElement(f,{store:n,contact:e,user:t,asyncSelectInterlocutor:d,asyncUnselectInterlocutor:h,key:r})}))),c.a.createElement("input",{disabled:0===t.interlocutors.length,className:0===t.interlocutors.length?"disabled":"",type:"button",value:">",onClick:Object(r.useCallback)((function(){return p.execute(t)}),[t,p])}))}),f=function(e){var t=e.contact,n=e.user,a=e.store,o=e.asyncSelectInterlocutor,l=e.asyncUnselectInterlocutor,m=Object(r.useState)(!1),f=Object(s.a)(m,2),p=f[0],b=f[1],d=Object(r.useCallback)((function(){p?l.execute({user:n,contact:t}):o.execute({user:n,contact:t})}),[p,t,n,l,o]);return Object(u.useEvt)((function(e){v.Evt.merge(e,[a.evtInterlocutorSelected,a.evtInterlocutorUnselected]).attach((function(e){return Object(i.same)(n,e.user)&&Object(i.same)(t,e.contact)}),(function(){return b(!p)})),v.Evt.merge(e,[a.evtConversationStarted,a.evtInterlocutorsEmptied]).attach((function(e){return Object(i.same)(n,e)&&p}),(function(){return b(!1)}))}),[t,n,a,p]),c.a.createElement("div",{className:"contact ".concat(p?"contact-selected":""),onClick:d},c.a.createElement("p",null,t.name))},p=n(1),b=n.n(p),d=n(5),h=(n(78),function(e){var t,n,a=e.user,o=e.isComponentVisible,v=e.store,m=Object(r.useState)(""),f=Object(s.a)(m,2),p=f[0],h=f[1],O=Object(r.useState)(10),j=Object(s.a)(O,2),g=j[0],C=j[1],w=Object(r.useState)(0),k=Object(s.a)(w,2),x=k[0],y=k[1],S=Object(r.useReducer)((function(e){return e+1}),0),I=Object(s.a)(S,2)[1],N=Object(r.useRef)(null),U=Object(l.b)(v.sendMessage),M=Object(l.b)(v.unselectConversation),V=Object(r.useCallback)((function(){U.execute({description:p,emitter:a}),h("")}),[p,U,a]);Object(u.useEvt)((function(e){v.evtMessageSent.attach((function(e){var t,n;return Object(i.same)(null===(t=e.emitter.currentConversation)||void 0===t?void 0:t.participants,null===(n=a.currentConversation)||void 0===n?void 0:n.participants)}),e,(function(){I(),H(),N&&N.current&&y(N.current.scrollHeight)})),v.evtConversationSelected.attach((function(e){return Object(i.same)(e.user,a)}),e,(function(){I(),C(10),H(),N&&N.current&&y(N.current.scrollHeight)}))}),[v,a]);var H=Object(r.useCallback)((function(){N&&N.current&&N.current.scrollTo(0,N.current.scrollHeight)}),[]),T=Object(r.useCallback)(Object(d.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N&&N.current){e.next=2;break}return e.abrupt("return");case 2:if(0===N.current.scrollTop){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,new Promise((function(e){void 0!==a.currentConversation&&a.currentConversation.messages.length!==g&&(g+5>a.currentConversation.messages.length&&(C(a.currentConversation.messages.length),e()),C(g+5),e())}));case 6:N.current.scrollTo(0,N.current.scrollHeight-x),y(N.current.scrollHeight);case 8:case"end":return e.stop()}}),e)}))),[g,a.currentConversation,x]);return c.a.createElement("div",{className:"Conversation",style:{height:o&&!M.loading?"100%":"0%"}},c.a.createElement("header",null,c.a.createElement("h3",null,null===(t=a.currentConversation)||void 0===t?void 0:t.participants.map((function(e){return"".concat(e.name,", ")}))),c.a.createElement("input",{type:"button",value:"<",onClick:Object(r.useCallback)((function(){M.execute(a)}),[a,M])})),c.a.createElement("div",{onScroll:T,ref:N,className:"messages"},null===(n=a.currentConversation)||void 0===n?void 0:n.messages.map((function(e,t){return void 0===a.currentConversation||t<a.currentConversation.messages.length-g?"":c.a.createElement(E,{key:t,message:e,user:a})}))),c.a.createElement("form",null,c.a.createElement("textarea",{className:"text-input",onChange:Object(r.useCallback)((function(e){var t=e.target;return h(t.value)}),[]),value:p}),c.a.createElement("input",{className:"submit",type:"submit",value:U.loading?"...":">",disabled:U.loading,onClick:V})))}),E=function(e){var t=e.message,n=e.user,a=Object(r.useRef)(null),o=Object(r.useCallback)(Object(d.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,1)}));case 2:if(a&&a.current){e.next=4;break}return e.abrupt("return");case 4:a.current.style.width="100%";case 5:case"end":return e.stop()}}),e)}))),[a]);return Object(r.useEffect)((function(){o()}),[o]),c.a.createElement("div",{ref:a,className:t.emitter===n?"outgoing":"incoming",style:{width:"50%"}},c.a.createElement("div",null,c.a.createElement("em",null,t.emitter.name),c.a.createElement("p",null,t.description)))},O=(n(79),function(e){var t=e.user,n=e.store,a=e.isUserVisible,o=Object(r.useState)(!1),l=Object(s.a)(o,2),f=l[0],p=l[1],b=Object(r.useState)(!1),d=Object(s.a)(b,2),E=d[0],O=d[1];Object(u.useEvt)((function(e){v.Evt.merge(e,[n.evtConversationStarted,n.evtInterlocutorsEmptied]).attach((function(e){return Object(i.same)(e,t)}),(function(){return p(!1)})),n.evtConversationUnselected.attach((function(e){return Object(i.same)(t,e)}),e,(function(){return O(!1)})),n.evtConversationSelected.attach((function(e){return Object(i.same)(e.user,t)}),e,(function(){return O(!0)}))}),[n,t]);var j=Object(r.useCallback)((function(e){n.selectConversation({conversation:e,user:t})}),[n,t]),g={display:f||E?"none":"flex"};return c.a.createElement("div",{className:a?"User":"hidden"},c.a.createElement("div",{className:"conversation-wrapper",style:g},c.a.createElement("header",null,c.a.createElement("div",null,c.a.createElement("h2",null,t.name)),c.a.createElement("input",{type:"button",value:"+",onClick:Object(r.useCallback)((function(){return p(!0)}),[])})),c.a.createElement("div",{className:"conversations"},0===t.conversations.length?"":t.conversations.map((function(e,t){return c.a.createElement("div",{className:"conversation-li",key:t,onClick:function(){return j(e)}},c.a.createElement("p",null,e.participants.map((function(e){return"".concat(e.name,", ")}))))})))),c.a.createElement(m,{store:n,user:t,isComponentVisible:f}),c.a.createElement(h,{isComponentVisible:E,store:n,user:t}))}),j=(n(80),function(e){var t=e.store,n=Object(r.useState)(0),a=Object(s.a)(n,2),o=a[0],u=a[1];return window.changeUser=function(e){e>=t.users.length||e<0||u(e)},c.a.createElement("div",{className:"App"},t.users.map((function(e,n){return c.a.createElement(O,{user:e,isUserVisible:o===n,store:t,key:n})})))});function g(){return C.apply(this,arguments)}function C(){return(C=Object(d.a)(b.a.mark((function e(){var t,n,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(e){return new Promise((function(t){return setTimeout(t,e)}))},n=function(){for(var e=[],t=0;t<30;t++)e.push({contacts:[],name:"User ".concat(t+1),interlocutors:[],conversations:[],currentConversation:void 0,id:t});return e.forEach((function(t,n){e.forEach((function(e,r){n!==r&&t.contacts.push(e)}))})),e}(),c={users:n,evtInterlocutorSelected:new v.Evt,evtInterlocutorUnselected:new v.Evt,evtInterlocutorsEmptied:new v.Evt,evtMessageSent:new v.Evt,evtConversationStarted:new v.Evt,evtConversationSelected:new v.Evt,evtConversationUnselected:new v.Evt,selectInterlocutor:function(){var e=Object(d.a)(b.a.mark((function e(n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.contact,a=n.user,e.next=3,t(300);case 3:a.interlocutors.push(r),c.evtInterlocutorSelected.post(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unselectInterlocutor:function(){var e=Object(d.a)(b.a.mark((function e(n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.contact,a=n.user,e.next=3,t(300);case 3:a.interlocutors.splice(a.interlocutors.indexOf(r),1),c.evtInterlocutorUnselected.post(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),emptyInterlocutors:function(){var e=Object(d.a)(b.a.mark((function e(n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(300);case 2:n.interlocutors=[],c.evtInterlocutorsEmptied.post(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),selectConversation:function(){var e=Object(d.a)(b.a.mark((function e(n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.conversation,a=n.user,e.next=3,t(300);case 3:a.currentConversation=r,c.evtConversationSelected.post(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unselectConversation:function(){var e=Object(d.a)(b.a.mark((function e(n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(300);case 2:n.currentConversation=void 0,c.evtConversationUnselected.post(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),newConversation:function(){var e=Object(d.a)(b.a.mark((function e(n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(300);case 2:if(e.prev=2,0!==n.interlocutors.length){e.next=5;break}throw new Error("Error! No interlocutors selected");case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return");case 11:a={id:r++,messages:[],participants:function(){var e=[];return e.push(n),n.interlocutors.forEach((function(t){e.push(t)})),e}()},n.conversations.push(a),n.interlocutors.forEach((function(e){return e.conversations.push(a)})),n.interlocutors=[],c.evtConversationStarted.post(n);case 16:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),sendMessage:function(){var e=Object(d.a)(b.a.mark((function e(n){var r,a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.emitter,o=n.description,e.next=3,t(300);case 3:null===(r=a.currentConversation)||void 0===r||r.messages.push({description:o,emitter:a,receivers:function(){var e=[];return a.currentConversation.participants.forEach((function(t){t!==a&&e.push(t)})),e}()}),c.evtMessageSent.post(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},e.next=5,t(1500);case 5:return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=function(){var e=Object(l.a)(g,[]);return void 0===e.result?c.a.createElement("h1",null,"Loading..."):c.a.createElement(j,{store:e.result})};o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(w,null)),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.d99a2b93.chunk.js.map