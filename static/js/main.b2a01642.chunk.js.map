{"version":3,"sources":["components/Messages/Message.tsx","components/Messages/Messages.tsx","components/Form/Form.tsx","components/Contacts/Contacts.tsx","components/User/User.tsx","components/App/App.tsx","logic.ts","index.tsx"],"names":["Message","props","message","className","direction","emitter","name","receiver","description","Messages","user","store","useReducer","x","forceUpdate","useEvt","ctx","evtMessageSent","attach","data","id","interlocutor","messages","map","index","key","reverse","Form","useState","textInput","setTextInput","asyncSendMessage","useAsyncCallback","sendMessage","handleSubmit","useCallback","e","preventDefault","execute","onSubmit","value","onChange","target","disabled","undefined","type","Contacts","contacts","contact","onClick","changeInterlocutor","User","isCurrentUser","useMemo","out","users","forEach","push","evtInterlocutorChanged","same","App","currentUserIndex","setCurrentUserIndex","toggleUser","length","getStore","a","simulateNetworkDelay","delay","Promise","resolve","setTimeout","i","Evt","params","post","newInterlocutor","Switcher","asyncGetStore","useAsync","result","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b2a01642.chunk.js","sourcesContent":["import React from \"react\";\nimport {Store} from \"../../logic\";\n\n\nexport const Message: React.FunctionComponent<{\n\n    message: Store[\"users\"][number][\"messages\"][number];\n\n}> = (props)=>{\n\n    const {message} = props;\n\n    return(\n        <div className={message.direction}>\n            <em>\n                {\n                    message.direction === \n                    \"incoming\" ? `From ${message.emitter.name}` : \n                    `to ${message.receiver.name}`\n                }\n            </em>\n\n            <p>{message.description}</p>\n        </div>\n\n    )\n\n}","import React, {useReducer} from \"react\";\nimport {Store} from \"../../logic\";\nimport { Message } from \"./Message\";\nimport {useEvt} from \"evt/hooks\";\n\n\n\nexport const Messages:React.FunctionComponent<{\n    user: Store[\"users\"][number];\n    store: Pick<Store,\n        \"evtMessageSent\"\n    >\n\n}> = (props)=>{\n\n    const {user, store} = props;\n    const [, forceUpdate] = useReducer(x=>x+1, 0);\n\n\n    useEvt(ctx=>{\n\n        store.evtMessageSent.attach(\n            data => data.user.id === user.id || data.user.interlocutor?.id === user.id,\n            ctx,\n            ()=> forceUpdate()\n        );\n\n    },[store]);\n\n\n\n\n    return(\n        <div className=\"message-wrapper\">\n            <h2>Messages</h2>\n            <div className=\"messages\">\n                {\n                    user.messages.map((message, index) => \n                        <Message key={index} message={message}/>\n                    ).reverse()\n                }\n            </div>\n\n        </div>\n\n    )\n\n}","import React, {useState, useCallback} from \"react\";\nimport {Store} from \"../../logic\";\nimport {useAsyncCallback} from \"react-async-hook\";\n\n\n\nexport const Form: React.FunctionComponent<{\n    store: Pick<Store,\n       \"sendMessage\" \n    >;\n    user: Store[\"users\"][number];\n\n}> = (props)=>{\n\n    const {store, user} = props;\n    const [textInput, setTextInput] = useState(\"\");\n\n    const asyncSendMessage = useAsyncCallback(store.sendMessage)\n\n    const handleSubmit = useCallback((e: React.FormEvent<HTMLFormElement>)=>{\n\n        e.preventDefault();\n\n        if(textInput === \"\") return;\n\n        asyncSendMessage.execute(\n            {\n                user,\n                \"description\": textInput\n            }\n        );\n\n        setTextInput(\"\");\n\n\n    },[textInput, asyncSendMessage, user]);\n\n    return(\n        <form onSubmit={handleSubmit}>\n            <textarea \n                value={textInput}\n                onChange={useCallback(({target}) => setTextInput(target.value),[])}\n            />\n\n            <input disabled={user.interlocutor === undefined} type=\"submit\" value=\"send message\"/>\n        </form>\n\n    )\n}","import React, {useCallback} from \"react\";\nimport {Store} from \"../../logic\";\n\n\n\n\nexport const Contacts: React.FunctionComponent<{\n    contacts: Store[\"users\"];\n    user: Store[\"users\"][number];\n    store: Pick<Store,\n        \"changeInterlocutor\"\n    >\n}> = (props)=>{\n    \n    const {contacts, user, store} = props;\n\n\n\n    return(\n        <ul>\n\n            {\n                contacts.map(\n                    contact => \n                    <li \n                        key={contact.id}\n                        onClick={()=> store.changeInterlocutor({user, \"newInterlocutor\": contact})}\n                    >\n                        {contact.name}\n                    </li>\n                )\n            }\n\n        </ul>\n    )\n}","import React, {useMemo, useReducer} from \"react\";\nimport {Store} from \"../../logic\";\nimport {Messages} from \"../Messages/Messages\";\nimport {Form} from \"../Form/Form\";\nimport {useEvt} from \"evt/hooks\";\nimport {Contacts} from \"../Contacts/Contacts\";\nimport {same} from \"evt/tools/inDepth\"\n\n\nexport const User: React.FunctionComponent<{\n    user: Store[\"users\"][number];\n    store: Store;\n    isCurrentUser: boolean;\n}> = (props)=>{\n\n    const {user, store, isCurrentUser} = props;\n    const [, forceUpdate] = useReducer(x=>x+1, 0);\n\n    const contacts = useMemo(()=>{\n        const out: Store[\"users\"] = [];\n\n        store.users.forEach(contact =>{\n            if(contact === user) return;\n\n            out.push(contact);\n\n\n        });\n\n        return out;\n\n    },[store, user]);\n\n    useEvt(ctx=>{\n        store.evtInterlocutorChanged.attach(\n            data => same(user, data.user),\n            ctx,\n            ()=> forceUpdate()\n        )\n\n    },[store])\n\n \n\n\n    \n\n    return(\n        <div className={`user ${isCurrentUser ? \"current\" : \"\"}`}>\n            <div className=\"contacts\">\n                {\n                    user.interlocutor === undefined ? \"\" : \n                    <h2>{user.interlocutor.name}</h2>\n                }\n                <Contacts contacts={contacts} user={user} store={store}/>\n            </div>\n\n            <div className=\"flex-message-and-form\">\n                <Messages \n                    user={user}\n                    store={store}\n\n                />\n\n                <Form\n\n                    user={user}\n                    store={store}\n                />\n                </div> \n\n        </div>\n    )\n}","import React, {useState, useCallback} from \"react\";\nimport {Store} from \"../../logic\";\nimport {User} from \"../User/User\";\nimport \"./App.scss\";\n\n\n\n\n\nexport const App:React.FunctionComponent<{\n    store: Store;\n}> = (props)=>{\n\n    const {store} = props;\n    const [currentUserIndex, setCurrentUserIndex] = useState(0);\n\n    const toggleUser = useCallback(()=>{\n        if(currentUserIndex === store.users.length - 1){\n            setCurrentUserIndex(0);\n            return;\n        }\n\n        setCurrentUserIndex(currentUserIndex + 1);\n\n    }, [currentUserIndex, store.users.length]);\n\n\n    return(\n        <div className=\"App\">\n            <header>\n                <h1>{store.users[currentUserIndex].name}</h1>\n                <input type=\"button\" value=\"Toggle User\" onClick={toggleUser}/>\n            </header>\n\n\n\n\n            {\n                store.users.map((user, index) => \n                            <User \n                                store={store}\n                                user={user}\n                                key={index}\n                                isCurrentUser={\n                                    currentUserIndex === index ? true : false\n                                }\n\n                            />\n\n                    )\n\n            }\n\n\n\n\n        </div>\n    )\n}","import {Evt, NonPostableEvt, ToPostableEvt} from \"evt\";\n\n\n\n\n\ntype Message = {\n    description: string;\n    direction: \"incoming\" | \"outgoing\";\n    receiver: User;\n    emitter: User;\n\n}\n\ntype User = {\n    name: String;\n    messages: Message[];\n    interlocutor: User | undefined;\n    id: number;\n}\nexport type Store = {\n    users: User[];\n    sendMessage: (params: {user: User; description: string}) => Promise<void>;\n    changeInterlocutor: (params: {user: User; newInterlocutor: User}) => Promise<void>;\n\n    evtMessageSent: NonPostableEvt<Parameters<Store[\"sendMessage\"]>[0]>;\n    evtInterlocutorChanged: NonPostableEvt<Parameters<Store[\"changeInterlocutor\"]>[0]>;\n\n}\n\nexport async function getStore(): Promise<Store>{\n\n    const simulateNetworkDelay = (delay: number)=>{\n        return new Promise<void>(resolve => setTimeout(resolve, delay));\n    };\n\n\n    const users: User[] = (()=>{\n        const out:User[] = [];\n\n        for(let i = 0; i < 3; i++){\n            out.push({\n                \"id\": i,\n                \"messages\": [],\n                \"name\": `user ${i+1}`,\n                \"interlocutor\": undefined\n            })\n        }\n\n        return out;\n\n    })(); \n\n    const store: ToPostableEvt<Store> = {\n        \"evtMessageSent\": new Evt(),\n        \"evtInterlocutorChanged\": new Evt(),\n\n        \"sendMessage\": async params => {\n            await simulateNetworkDelay(300);\n\n            const {user, description} = params;\n            if(user.interlocutor === undefined){\n                return;\n            }\n\n            user.messages.push({\n                description, \n                \"direction\": \"outgoing\", \n                \"receiver\": user.interlocutor,\n                \"emitter\": user\n            });\n            user.interlocutor.messages.push({\n                description, \n                \"direction\": \"incoming\", \n                \"receiver\": user.interlocutor,\n                \"emitter\": user\n            });\n\n\n            store.evtMessageSent.post(params);\n\n        },\n\n        \"changeInterlocutor\": async params => {\n            const {user, newInterlocutor} = params;\n\n            await simulateNetworkDelay(300);\n\n            user.interlocutor = newInterlocutor;\n\n            store.evtInterlocutorChanged.post(params);\n\n        },\n\n        users\n    }\n\n    await simulateNetworkDelay(1500);\n\n    return store;\n\n\n\n}\n\n\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\n//import * as serviceWorker from './serviceWorker';\nimport {App} from \"./components/App/App\";\nimport {useAsync} from \"react-async-hook\";\nimport {getStore} from \"./logic\";\n\nconst Switcher: React.FunctionComponent = ()=>{\n  \n  const asyncGetStore = useAsync(getStore, []);\n  \n  \n  return(\n    asyncGetStore.result === undefined ? \n      <h1>Loading...</h1> : \n      <App store={asyncGetStore.result} \n    />\n\n  )\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <Switcher />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n//serviceWorker.unregister();\n"],"sourceRoot":""}